---
number: 3
title: Model Building and Reporting
day: 18 februar
type: lab
layout: remark
---

# {{ page.title }} #
# {{ page.day }} #

???

S&#248;nderskov Ch. 8 (153-185)


---
## Outline

 - Categorical covariates
 
 - Regression Output
 
 - Work on S&#248;nderskov Ch. 8 (153-185)


---
## Categorical covariates

 - Regression on categorical covariates involves either:
   1. Assuming the categories are essentially continuous
   2. Manually creating indicator "dummies" for each level
   3. Using "factor variable" syntax *
   
 - Factor variables are the best general solution:
 
```
reg dv covariate

reg dv i.covariate
```

.footnote[* S&#248;nderskov pp.158-161]


???

The `i.covariate` syntax automatically generates categories.

You can also specify a baseline category explicitly using slightly difference syntax.

And then you can use `test` to compare coefficients across categories.

---
## `regress` | `reg`

```
 regress stores the following in e():

Scalars        
  e(N)                number of observations
  e(mss)              model sum of squares
  e(df_m)             model degrees of freedom
  e(rss)              residual sum of squares
  e(df_r)             residual degrees of freedom
  e(r2)               R-squared
  e(r2_a)             adjusted R-squared
  e(F)                F statistic
  e(rmse)             root mean squared error
  e(ll)               log likelihood under additional assumption of i.i.d.
                        normal errors
  e(ll_0)             log likelihood, constant-only model
  e(N_clust)          number of clusters
  e(rank)             rank of e(V)
```

---
## `regress` | `reg`

```
 regress stores the following in e():

Macros         
  e(cmd)              regress
  e(cmdline)          command as typed
  e(depvar)           name of dependent variable
  e(model)            ols or iv
  e(wtype)            weight type
  e(wexp)             weight expression
  e(title)            title in estimation output when vce() is not ols
  e(clustvar)         name of cluster variable
  e(vce)              vcetype specified in vce()
  e(vcetype)          title used to label Std. Err.
  e(properties)       b V
  e(estat_cmd)        program used to implement estat
  e(predict)          program used to implement predict
  e(marginsok)        predictions allowed by margins
  e(asbalanced)       factor variables fvset as asbalanced
  e(asobserved)       factor variables fvset as asobserved
```

---
## `regress` | `reg`

```
 regress stores the following in e():

Matrices       
  e(b)                coefficient vector
  e(V)                variance-covariance matrix of the estimators
  e(V_modelbased)     model-based variance

Functions      
  e(sample)           marks estimation sample
```

---
## `regress` | `reg`

What do we do with all those values?

```
help ereturn

* e.g., retrieve coefficients, again
ereturn display
```

---
## Output and export

 - Rarely do we just want results on the console
   - You can save these to a log, but they don't look nice
 
 - Irrelevant information in default output
 
 - We generally want some nicer output

---
## `display`

If we just want one value, we can pull them from `e()`

```
* return all values from e()
ereturn list

* display a single value
display e(N)
display e(rmse)

* display coefficients
matrix list e(b)
```



---
## `estimates`

We can store results and then print them nicely

```
quietly reg growth lcon
estimates store small
* print results
estimates table
* print results with summary stats
estimates table, se stats(N r2_a)
* format printing of coefs/SEs
estimates table small large, b(%9.2f) se(%9.2f) stats(N r2_a)
```

.footnote[Lots of options, see: `help estimates table`]

---
## `estimates`

We can also combine multiple objects:

```
quietly reg growth lcon lconsq
estimates store large

estimates table small large
estimates table small large, se stats(N r2_a)
```

---
## User-defined programs

 - Stata does a lot but users can also improve it
 - It's easy to install user-defined programs from the web


---
## User-defined programs

 - Install user-defined program `estout`:
 
```
ssc install estout, replace 
```
 
 
.footnote[See http://repec.org/bocode/e/estout/index.html]


---
## Using the `estout` program

Two functions:

 - `esttab`: Simple regression tables
 - `estout`: Better formatted tables

.red[Use `esttab`!]

 - `eststo`: Store multiple models


---
.left-column[
## estout
]
.right-column[
```
reg growth lcon
estout
```

.footnote[There are lots of options: `help estout`]
]


---
.left-column[
## estout
## esttab
]
.right-column[
```
reg growth lcon
* print results (but note t-statistics by default)
esttab
* better formatting
esttab, b(%9.2f) se(%9.2f)
```

.footnote[There are lots of options: `help esttab` (and `help format`)]
]

---
.left-column[
## estout
## esttab
## eststo
]
.right-column[

```
quietly reg growth lcon
eststo

quietly reg growth lcon lconsq
eststo

estout, b(%9.2f) se(%9.2f) stats(rmse)
esttab, b(%9.2f) se(%9.2f) stats(rmse)
```
]


---
## Model comparison

 - Sometimes we need to do formal model comparison

 - By default, Stata compares any model to "null" model
   - The "null" model has no independent variables
   
 - To compare multiple "nested" models, use `nestreg`
 
 
---
## Model comparison

```
nestreg: regress growth lcon (lconsq)
```

The key statistic of interest here is the F-statistic

This tells us whether the model yields a statistically significant reduction in the residual sum of squares (i.e., the portion of the variance in the data unexplained by the model)


---
## Lab work

Work through examples in S&#248;nderskov

